# Identity for Microsoft Azure Active Directory in Electron (MS Internal)

The msint-identity-aad-electron module implements the browser-based interaction for the AAD authorization code grant flow.

## Pre-requisites

Because this module depends on various native node modules, usage of this module depends on certain build tools being present on the target machine.

### OSX
Install [Xcode](https://developer.apple.com/xcode/downloads/) to get the native build tools.

### Windows
Install [Visual Studio 2015](\\cpvsbuild\drops\dev14\d14rel\layouts\x86ret\23107.10\enu\vs\enterprise\dvd\vs_enterprise.exe) to get the native build tools. Ensure during installation that all the C++ optional components are selected (none of them are installed by default).

Install [Python 2.7.3]((https://www.python.org/download/releases/2.7.3/#download). Do NOT get a later version.

### NPM Configuration
As an MS internal module, you must configure npm to use the internal NPM registry:

```
npm set //ms-npm/:username=xxx
npm set //ms-npm/:email=xxx@microsoft.com
npm set //ms-npm/:_password=xxx
```

(You can replace "xxx" with whatever value you want, or just leave it).

## Installation

Install this module into your application using npm:

```
npm install msint-identity-aad-electron --registry=http://ms-npm --save
```

The act of installing the module will compile the source code for the keytar and selectcert dependencies. For this to work successfully on Windows, run this command from inside a Developer Command Prompt for VS2015.

There is one additional requirement for installation when working with Electron. When npm compiles the source code during install, it statically links in certain pieces of the build of node you have installed on your system. Unfortunately, this is rarely the same as the build of node that is integrated with Electron. This means that you have to re-compile the native node modules against the version of node that comes with the Electron build you are using.

To do this, you need to get the electron-rebuild module using npm:

```
npm install electron-rebuild --save-dev
```

Once this is installed, go to your project root and type the following command:

```
// Mac
./node_modules/.bin/electron-rebuild -v 0.32.2

// Windows
node_modules\.bin\electron-rebuild -v 0.32.2 -i ia32
```

Replace "0.32.2" with the build of Electron you are using. On Windows, since there are 32 and 64-bit versions of Electron available, the "ia32" value specifies the architecture to use. This can be "ia32" for 32-bit or "x64" for 64-bit.

## Usage

This module offers options for invoking the browser-based interaction from a main Electron process or a renderer Electron process.
In either case, require the module in your main startup code file for the Electron application:

```
import "msint-identity-aad-electron";
```

Then in a module running in either the main process or a renderer process:

```
import identity_aad from "msint-identity-aad";
import { getAuthorizationCode } from "msint-identity-aad-electron";

...

let aadProvider = identity_aad.createAuthorizationCodeGrantFlowProvider(getAuthorizationCode, ...);
```