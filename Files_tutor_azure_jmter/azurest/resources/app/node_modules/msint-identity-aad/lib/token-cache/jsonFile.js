/*!---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *----------------------------------------------------------*/
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var fs = require("fs");
var q_1 = require("q");
var Q = require("q");
var util_1 = require("msint-identity/lib/util");
var core = require("./core");
var JsonFileTokenCache = (function () {
    function JsonFileTokenCache(dir, filename, noProbe) {
        this.filename = util_1.createIfNotExists(filename || ".adalcache", dir, noProbe);
    }
    JsonFileTokenCache.prototype.doOperation = function (op) {
        var _this = this;
        var activeOperation = this.activeOperation || Q.resolve(null);
        activeOperation = activeOperation.then(op).fin(function () {
            if (_this.activeOperation === activeOperation) {
                _this.activeOperation = null;
            }
        });
        return this.activeOperation = activeOperation;
    };
    JsonFileTokenCache.prototype.readCache = function () {
        var _this = this;
        return q_1.Promise(function (resolve) {
            fs.readFile(_this.filename, "utf8", function (err, data) {
                var cache;
                if (err) {
                    // Disregard read errors
                    data = "";
                }
                try {
                    // Parse the data
                    cache = JSON.parse(data || "[]");
                }
                catch (e) {
                    // Disregard invalid JSON
                    cache = [];
                }
                // Disregard if unexpected data
                if (!Array.isArray(cache)) {
                    cache = [];
                }
                // Fix up fields that require special formatting
                cache.forEach(function (entry) {
                    entry.expiresOn = new Date(entry.expiresOn);
                });
                resolve(cache);
            });
        });
    };
    JsonFileTokenCache.prototype.findInCache = function (cache, query) {
        return core.find(cache, query);
    };
    JsonFileTokenCache.prototype.find = function (query, callback) {
        var _this = this;
        this.doOperation(function () { return _this.readCache()
            .then(function (cache) { return _this.findInCache(cache, query); })
            .then(function (results) { return callback(null, results); }); });
    };
    JsonFileTokenCache.prototype.writeCache = function (cache) {
        var _this = this;
        return q_1.Promise(function (resolve) {
            fs.writeFile(_this.filename, JSON.stringify(cache, null, 4), function () { return resolve(null); });
        });
    };
    JsonFileTokenCache.prototype.addToCache = function (cache, entries) {
        return core.add(cache, entries);
    };
    JsonFileTokenCache.prototype.add = function (entries, callback) {
        var _this = this;
        this.doOperation(function () { return _this.readCache()
            .then(function (cache) { return _this.addToCache(cache, entries); })
            .then(function (updatedCache) { return _this.writeCache(updatedCache); })
            .then(function () { return callback(null); }); });
    };
    JsonFileTokenCache.prototype.removeFromCache = function (cache, entries) {
        return core.remove(cache, entries);
    };
    JsonFileTokenCache.prototype.remove = function (entries, callback) {
        var _this = this;
        this.doOperation(function () { return _this.readCache()
            .then(function (cache) { return _this.removeFromCache(cache, entries); })
            .then(function (updatedCache) { return _this.writeCache(updatedCache); })
            .then(function () { return callback(null); }); });
    };
    return JsonFileTokenCache;
}());
exports.default = JsonFileTokenCache;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90b2tlbi1jYWNoZS9qc29uRmlsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OERBRThEO0FBRTlELFlBQVksQ0FBQzs7QUFHYix1QkFBeUI7QUFDekIsdUJBQTRCO0FBQzVCLHFCQUF1QjtBQUV2QixnREFBNEQ7QUFFNUQsNkJBQStCO0FBRS9CO0lBSUksNEJBQVksR0FBWSxFQUFFLFFBQWlCLEVBQUUsT0FBaUI7UUFDMUQsSUFBSSxDQUFDLFFBQVEsR0FBRyx3QkFBaUIsQ0FBQyxRQUFRLElBQUksWUFBWSxFQUFFLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM5RSxDQUFDO0lBRU8sd0NBQVcsR0FBbkIsVUFBdUIsRUFBb0I7UUFBM0MsaUJBUUM7UUFQRyxJQUFJLGVBQWUsR0FBRyxJQUFJLENBQUMsZUFBZSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQU0sSUFBSSxDQUFDLENBQUM7UUFDbkUsZUFBZSxHQUFHLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQzNDLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxlQUFlLEtBQUssZUFBZSxDQUFDLENBQUMsQ0FBQztnQkFDM0MsS0FBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7WUFDaEMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDO0lBQ2xELENBQUM7SUFFTyxzQ0FBUyxHQUFqQjtRQUFBLGlCQStCQztRQTlCRyxNQUFNLENBQUMsV0FBTyxDQUF5QixVQUFBLE9BQU87WUFDMUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxVQUFDLEdBQUcsRUFBRSxJQUFJO2dCQUN6QyxJQUFJLEtBQVksQ0FBQztnQkFFakIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDTix3QkFBd0I7b0JBQ3hC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SSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVNLG1DQUFNLEdBQWIsVUFBYyxPQUErQixFQUFFLFFBQWlDO1FBQWhGLGlCQU1DO1FBTEcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLFNBQVMsRUFBRTthQUNsQyxJQUFJLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsRUFBcEMsQ0FBb0MsQ0FBQzthQUNuRCxJQUFJLENBQUMsVUFBQSxZQUFZLElBQUksT0FBQSxLQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUE3QixDQUE2QixDQUFDO2FBQ25ELElBQUksQ0FBQyxjQUFNLE9BQUEsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFkLENBQWMsQ0FBQyxFQUhSLENBR1EsQ0FDOUIsQ0FBQztJQUNOLENBQUM7SUFDTCx5QkFBQztBQUFELENBM0ZBLEFBMkZDLElBQUEiLCJmaWxlIjoidG9rZW4tY2FjaGUvanNvbkZpbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICogQ29weXJpZ2h0IChDKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXHJcblxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbmltcG9ydCAqIGFzIGFkYWwgZnJvbSBcImFkYWwtbm9kZVwiO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcclxuaW1wb3J0IHsgUHJvbWlzZSB9IGZyb20gXCJxXCI7XHJcbmltcG9ydCAqIGFzIFEgZnJvbSBcInFcIjtcclxuXHJcbmltcG9ydCB7IGNyZWF0ZUlmTm90RXhpc3RzIH0gZnJvbSBcIm1zaW50LWlkZW50aXR5L2xpYi91dGlsXCI7XHJcblxyXG5pbXBvcnQgKiBhcyBjb3JlIGZyb20gXCIuL2NvcmVcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEpzb25GaWxlVG9rZW5DYWNoZSBpbXBsZW1lbnRzIGFkYWwuVG9rZW5DYWNoZSB7XHJcbiAgICBwcml2YXRlIGZpbGVuYW1lOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGFjdGl2ZU9wZXJhdGlvbjogUHJvbWlzZTxhbnk+O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGRpcj86IHN0cmluZywgZmlsZW5hbWU/OiBzdHJpbmcsIG5vUHJvYmU/OiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5maWxlbmFtZSA9IGNyZWF0ZUlmTm90RXhpc3RzKGZpbGVuYW1lIHx8IFwiLmFkYWxjYWNoZVwiLCBkaXIsIG5vUHJvYmUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZG9PcGVyYXRpb248VD4ob3A6ICgpID0+IFByb21pc2U8VD4pIHtcclxuICAgICAgICBsZXQgYWN0aXZlT3BlcmF0aW9uID0gdGhpcy5hY3RpdmVPcGVyYXRpb24gfHwgUS5yZXNvbHZlPGFueT4obnVsbCk7XHJcbiAgICAgICAgYWN0aXZlT3BlcmF0aW9uID0gYWN0aXZlT3BlcmF0aW9uLnRoZW4ob3ApLmZpbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZU9wZXJhdGlvbiA9PT0gYWN0aXZlT3BlcmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZU9wZXJhdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVPcGVyYXRpb24gPSBhY3RpdmVPcGVyYXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZWFkQ2FjaGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2U8YWRhbC5Ub2tlbkNhY2hlRW50cnlbXT4ocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIGZzLnJlYWRGaWxlKHRoaXMuZmlsZW5hbWUsIFwidXRmOFwiLCAoZXJyLCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY2FjaGU6IGFueVtdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBEaXNyZWdhcmQgcmVhZCBlcnJvcnNcclxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFBhcnNlIHRoZSBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgY2FjaGUgPSBKU09OLnBhcnNlKGRhdGEgfHwgXCJbXVwiKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBEaXNyZWdhcmQgaW52YWxpZCBKU09OXHJcbiAgICAgICAgICAgICAgICAgICAgY2FjaGUgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBEaXNyZWdhcmQgaWYgdW5leHBlY3RlZCBkYXRhXHJcbiAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY2FjaGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FjaGUgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBGaXggdXAgZmllbGRzIHRoYXQgcmVxdWlyZSBzcGVjaWFsIGZvcm1hdHRpbmdcclxuICAgICAgICAgICAgICAgIGNhY2hlLmZvckVhY2goZW50cnkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgZW50cnkuZXhwaXJlc09uID0gbmV3IERhdGUoZW50cnkuZXhwaXJlc09uKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoPGFkYWwuVG9rZW5DYWNoZUVudHJ5W10+IGNhY2hlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGZpbmRJbkNhY2hlKGNhY2hlOiBhZGFsLlRva2VuQ2FjaGVFbnRyeVtdLCBxdWVyeTogYWRhbC5Ub2tlbkNhY2hlUXVlcnkpIHtcclxuICAgICAgICByZXR1cm4gY29yZS5maW5kKGNhY2hlLCBxdWVyeSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGZpbmQocXVlcnk6IGFkYWwuVG9rZW5DYWNoZVF1ZXJ5LCBjYWxsYmFjazogKGVycm9yOiBFcnJvciwgcmVzdWx0czogYWRhbC5Ub2tlbkNhY2hlRW50cnlbXSkgPT4gdm9pZCkge1xyXG4gICAgICAgIHRoaXMuZG9PcGVyYXRpb24oKCkgPT4gdGhpcy5yZWFkQ2FjaGUoKVxyXG4gICAgICAgICAgICAudGhlbihjYWNoZSA9PiB0aGlzLmZpbmRJbkNhY2hlKGNhY2hlLCBxdWVyeSkpXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdHMgPT4gY2FsbGJhY2sobnVsbCwgcmVzdWx0cykpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHdyaXRlQ2FjaGUoY2FjaGU6IGFkYWwuVG9rZW5DYWNoZUVudHJ5W10pIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgZnMud3JpdGVGaWxlKHRoaXMuZmlsZW5hbWUsIEpTT04uc3RyaW5naWZ5KGNhY2hlLCBudWxsLCA0KSwgKCkgPT4gcmVzb2x2ZShudWxsKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGFkZFRvQ2FjaGUoY2FjaGU6IGFkYWwuVG9rZW5DYWNoZUVudHJ5W10sIGVudHJpZXM6IGFkYWwuVG9rZW5DYWNoZUVudHJ5W10pIHtcclxuICAgICAgICByZXR1cm4gY29yZS5hZGQoY2FjaGUsIGVudHJpZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGQoZW50cmllczogYWRhbC5Ub2tlbkNhY2hlRW50cnlbXSwgY2FsbGJhY2s6IChlcnJvcj86IEVycm9yKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgdGhpcy5kb09wZXJhdGlvbigoKSA9PiB0aGlzLnJlYWRDYWNoZSgpXHJcbiAgICAgICAgICAgIC50aGVuKGNhY2hlID0+IHRoaXMuYWRkVG9DYWNoZShjYWNoZSwgZW50cmllcykpXHJcbiAgICAgICAgICAgIC50aGVuKHVwZGF0ZWRDYWNoZSA9PiB0aGlzLndyaXRlQ2FjaGUodXBkYXRlZENhY2hlKSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gY2FsbGJhY2sobnVsbCkpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgcmVtb3ZlRnJvbUNhY2hlKGNhY2hlOiBhZGFsLlRva2VuQ2FjaGVFbnRyeVtdLCBlbnRyaWVzOiBhZGFsLlRva2VuQ2FjaGVFbnRyeVtdKSB7XHJcbiAgICAgICAgcmV0dXJuIGNvcmUucmVtb3ZlKGNhY2hlLCBlbnRyaWVzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVtb3ZlKGVudHJpZXM6IGFkYWwuVG9rZW5DYWNoZUVudHJ5W10sIGNhbGxiYWNrOiAoZXJyb3I/OiBFcnJvcikgPT4gdm9pZCkge1xyXG4gICAgICAgIHRoaXMuZG9PcGVyYXRpb24oKCkgPT4gdGhpcy5yZWFkQ2FjaGUoKVxyXG4gICAgICAgICAgICAudGhlbihjYWNoZSA9PiB0aGlzLnJlbW92ZUZyb21DYWNoZShjYWNoZSwgZW50cmllcykpXHJcbiAgICAgICAgICAgIC50aGVuKHVwZGF0ZWRDYWNoZSA9PiB0aGlzLndyaXRlQ2FjaGUodXBkYXRlZENhY2hlKSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gY2FsbGJhY2sobnVsbCkpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
