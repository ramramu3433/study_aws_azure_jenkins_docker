# Identity for Microsoft Azure Active Directory (MS Internal)

The msint-identity-aad module supplies an account provider for Microsoft Azure Active Directory.

It implements various AAD flows for signing into an account and is capable of acquiring and caching access tokens to various AAD resources.

This module provides some built-in ADAL token cache implementations and currently implements a single AAD flow - the authorization code grant flow.

## Pre-requisites

Because this module depends on keytar, a native node module for accessing secure stores on OSX and Windows, usage of this module depends on certain build tools being present on the target machine.

### OSX
Install [Xcode](https://developer.apple.com/xcode/downloads/) to get the native build tools.

### Windows
Install [Visual Studio 2015](\\cpvsbuild\drops\dev14\d14rel\layouts\x86ret\23107.10\enu\vs\enterprise\dvd\vs_enterprise.exe) to get the native build tools. Ensure during installation that all the C++ optional components are selected (none of them are installed by default).

Install [Python 2.7.3]((https://www.python.org/download/releases/2.7.3/#download). Do NOT get a later version.

### NPM Configuration
As an MS internal module, you must configure npm to use the internal NPM registry:

```
npm set //ms-npm/:username=xxx
npm set //ms-npm/:email=xxx@microsoft.com
npm set //ms-npm/:_password=xxx
```

(You can replace "xxx" with whatever value you want, or just leave it).

## Installation

Install this module into your application using npm:

```
npm install msint-identity-aad --registry=http://ms-npm --save
```

The act of installing the module will compile the source code for the keytar dependency. For this to work successfully on Windows, run this command from inside a Developer Command Prompt for VS2015.

## Usage

Require the module in your code:

```
import * as identity_aad from "msint-identity-aad";
```

Create one of the built-in token caches. There is one that works in-memory:

```
let cache = identity_aad.createInMemoryTokenCache();
```

One that saves to a JSON file (not recommended, since tokens are stored in plaintext):

```
let cache = identity_aad.createJsonFileTokenCache(null, ".adalcache");
```

And one that saves to a JSON file but extracts tokens and stores them in the secure store offered by the operating system (on OSX, the Mac Keychain; on Windows, the Windows Credential Store):

```
let cache = identity_aad.createJsonFileWithNativeTokenCache(null, ".adalcache");
```

Now, create an account provider for a specific AAD authentication flow:

```
let provider = identity_aad.createAuthorizationCodeGrantFlowProvider(getAuthorizationCode, options, cache);
```

Since this module does not offer UI, but the authorization code grant flow requires browser-based interaction with the user, an additional module that works in the Electron shell, msint-identity-aad-electron, can be used to supply the getAuthorizationCode parameter to this method.
The options parameter allows you to customize all aspects of flow for the particular application: resource endpoints, client ID, redirect URI, site ID, and so on.