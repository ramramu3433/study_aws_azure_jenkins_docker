{"version":3,"sources":["../pluginHost/scriptedControl.ts"],"names":[],"mappings":"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","file":"scriptedControl.js","sourcesContent":["/*---------------------------------------------------------\r\n * Copyright (C) Microsoft Corporation. All rights reserved.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\nimport { Promise } from \"q\";\r\nimport * as Path from 'path';\r\nimport * as Q from \"q\";\r\nimport {IHostLibraryProviders} from \"./interfaces/iHostLibraryProviders\";\r\nimport {IJSONManifest} from \"./common/iJSONManifest\";\r\nimport {IEventTarget, IEvent, EventTarget, Event} from \"./common/event\";\r\nimport {ThemeMap} from \"./common/themeMap\";\r\nimport {ResourceMap} from \"./common/resourceMap\";\r\nimport {Resources} from \"./common/resources\";\r\nimport {ResourceAliases} from \"./common/resourceAliases\";\r\nimport {ExecuteCommandEventArgs} from \"./common/executeCommandEventArgs\";\r\nimport {StorageMarshaler} from \"./messaging/storageMarshaler\";\r\nimport {PortMarshaler, JsonPortMarshaler, SynchronousJsonPortMarshaler} from \"./messaging/marshaler\";\r\nimport {CommunicationManager, Port} from \"./messaging/communication\";\r\nimport {OutputMarshaler} from \"./messaging/outputMarshaler\";\r\nimport {ThemeMarshaler} from \"./messaging/themeMarshaler\";\r\nimport {ResourcesMarshaler} from \"./messaging/resourcesMarshaler\";\r\nimport {CommandsMarshaler} from \"./messaging/commandMarshaler\";\r\nimport {ContextMenuMarshaler} from \"./messaging/contextMenuMarshaler\";\r\nimport {SettingsMarshaler} from \"./messaging/settingsMarshaler\";\r\nimport {HostMarshaler} from \"./messaging/hostMarshaler\";\r\nimport {TooltipMarshaler} from \"./messaging/tooltipMarshaler\";\r\nimport * as Electron from \"electron\";\r\n\r\nlet uri = require(\"urijs\");\r\n\r\nconst outputMarhalerName: string = \"Plugin.Output\";\r\nconst storageMarshalerName: string = \"Plugin.Storage\";\r\nconst themeMarshalerName: string = \"Plugin.Theme\";\r\nconst resourcesMarshalerName: string = \"Plugin.Resources\";\r\nconst commandsMarshalerName: string = \"plugin.VS.Commands\";\r\nconst settingsMarshalerName: string = \"Plugin.Settings\";\r\nconst contextMenuMarshalerName: string = \"Plugin.ContextMenu\";\r\nconst hostMarshalerName: string = \"Plugin.Host\";\r\nconst tooltipMarshalerName: string = \"Plugin.Tooptip\";\r\n\r\nexport class ScriptedControl extends EventTarget {\r\n    private static lastControlId = 0;\r\n\r\n    private communicationManager: CommunicationManager;\r\n    private exportedObjects: { [name: string]: PortMarshaler };\r\n\r\n    public iframe: HTMLIFrameElement | Electron.WebviewTag;\r\n    private startUrl: string;\r\n    private parameters: { [name: string]: string };\r\n    private useNativeWebView: boolean;\r\n    private baseDirectory: string;\r\n    private providers: IHostLibraryProviders;\r\n\r\n    constructor(private hostName: string,\r\n        jsonManifest: IJSONManifest,\r\n        baseDirectory: string,\r\n        parameters: { [name: string]: string },\r\n        initInSeparateProcess: boolean,\r\n        providers: IHostLibraryProviders) {\r\n        super();\r\n\r\n        this.baseDirectory = baseDirectory;\r\n        this.parameters = parameters;\r\n        this.useNativeWebView = initInSeparateProcess;\r\n        this.providers = providers;\r\n\r\n        if (!jsonManifest) {\r\n            throw new Error('Invalid jsonManifest');\r\n        }\r\n        if (typeof baseDirectory !== 'string') {\r\n            throw new Error('Invalid baseDirectory');\r\n        }\r\n        if (!this.providers) {\r\n            throw new Error('Invalid providers');\r\n        }\r\n        if (!this.providers.fileProvider || typeof this.providers.fileProvider.getFileContents !== 'function') {\r\n            throw new Error('Invalid fileProvider');\r\n        }\r\n\r\n        this.communicationManager = new CommunicationManager(this.postMessageToPlugin.bind(this));\r\n        this.exportedObjects = {\r\n        };\r\n        this.communicationManager.addEventListener('BeforeControlReady', (source, args) => {\r\n            if (!this.useNativeWebView) {\r\n                var iframe = <HTMLIFrameElement>this.iframe;\r\n                iframe.contentWindow.onfocus = () => {\r\n                    this.dispatchEvent('GotFocus', new Event());\r\n                };\r\n                iframe.contentWindow.onblur = () => {\r\n                    this.dispatchEvent('LostFocus', new Event());\r\n                };\r\n            } else {\r\n                var webView = <Electron.WebviewTag>this.iframe;\r\n                webView.onfocus = () => {\r\n                    this.dispatchEvent('GotFocus', new Event());\r\n                };\r\n                webView.onblur = () => {\r\n                    this.dispatchEvent('LostFocus', new Event());\r\n                };\r\n            }\r\n            this.dispatchEvent('BeforeControlReady', args);\r\n        });\r\n        this.communicationManager.addEventListener('ControlReady', (source, args) => {\r\n            this.dispatchEvent('ControlReady', args);\r\n        });\r\n\r\n        var url = this.baseDirectory + jsonManifest.start_url + this.getURLParameters();\r\n        this.startUrl = this.providers.fileProvider.getResolvedFilePath(url);\r\n        this.createFrame(this.startUrl, jsonManifest);\r\n    }\r\n\r\n    private createFrame(src: string, jsonManifest: IJSONManifest): void {\r\n        if (!this.useNativeWebView) {\r\n            var frame = <HTMLIFrameElement>document.createElement('iframe');\r\n            frame.setAttribute('sandbox', 'allow-scripts allow-popups allow-same-origin');\r\n            frame.id = 'ScriptedControl_' + ScriptedControl.lastControlId++;\r\n            frame.src = src;\r\n            this.iframe = frame;\r\n\r\n            window.addEventListener('message', (event) => {\r\n                if (event.source === frame.contentWindow) {\r\n                    event.stopPropagation();\r\n                    this.processMessage(event.data.toString());\r\n                }\r\n            });\r\n        } else {\r\n            var s = '<webview nodeintegration disablewebsecurity src=\"' + src + '\"></webview>';\r\n\r\n            var div = document.createElement('div');\r\n            div.innerHTML = s;\r\n            var webview = <Electron.WebviewTag>div.firstChild;\r\n            webview.addEventListener('ipc-message', (event: any) => {\r\n                this.processMessage(event.channel);\r\n            });\r\n            webview.addEventListener('destroyed', () => {\r\n                this.iframe = null;\r\n            });\r\n            /*\r\n            webview.addEventListener('did-start-loading', () => {\r\n                if (Electron.getCurrentWindow().isDevToolsOpened()) {\r\n                    webview.openDevTools();\r\n                }\r\n            });\r\n\r\n            webview.addEventListener('console-message', (e: any) => {\r\n                console.log('Webview output: ', <string> e.message);\r\n            });\r\n            webview.addEventListener('did-get-redirect-request', () => console.log('Webview did-get-redirect-request') );\r\n            webview.addEventListener('new-window', () => console.log('webview new-window') );\r\n            webview.addEventListener('crashed', () => console.log('webview crashed') );\r\n            webview.addEventListener('close', () => console.log('webview close') );\r\n            webview.addEventListener('did-stop-loading', () => console.log('webview did-stop-loading'));\r\n            webview.addEventListener('did-frame-finish-load', () => console.log('webview did-frame-finish-load'));\r\n            webview.addEventListener('did-fail-load', () => console.log('webview did-fail-load'));\r\n            webview.addEventListener('did-finish-load', () => console.log('webview did-finish-load'));\r\n            */\r\n            this.iframe = webview;\r\n        }\r\n        this.publishLibraryObjects(jsonManifest);\r\n    }\r\n\r\n    public getURLParameters(): string {\r\n        var scriptLocation = Path.resolve(__dirname, \"..\", \"plugin.electron.js\");\r\n        var query: {\r\n            pluginUrl: string;\r\n            hostDescription: string;\r\n            parameters: string;\r\n        };\r\n\r\n        query = {\r\n            pluginUrl: encodeURIComponent(scriptLocation),\r\n            hostDescription: this.hostName,\r\n            parameters: this.parameters ? encodeURIComponent(JSON.stringify(this.parameters)) : \"\"\r\n        };\r\n\r\n        return \"?\" + uri.buildQuery(query);\r\n    }\r\n\r\n    public reportError(message: string): void {\r\n        if (this.providers.logProvider) {\r\n            this.providers.logProvider.logError(message);\r\n        }\r\n    }\r\n\r\n    public createPort(name: string): Port {\r\n        return this.communicationManager.createPort(name);\r\n    }\r\n\r\n    public fireEvent(eventName: string, eventArgs: Event): void {\r\n        this.communicationManager.fireEvent(eventName, eventArgs);\r\n    }\r\n\r\n    public publishObject(name: string, objectMarshaler: PortMarshaler): void {\r\n        if (typeof name !== 'string') {\r\n            throw new Error('Invalid name');\r\n        }\r\n        if (!objectMarshaler || typeof objectMarshaler.initialize !== 'function') {\r\n            throw new Error('Invalid objectMarshaler');\r\n        }\r\n        var port: Port;\r\n        try {\r\n            port = this.createPort(name);\r\n            objectMarshaler.initialize(port);\r\n            this.exportedObjects[name] = objectMarshaler;\r\n            port.connect();\r\n        } catch (e) {\r\n            if (port) {\r\n                port.close();\r\n            }\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    private controlClosed = false;\r\n\r\n    public close(): void {\r\n        if (this.controlClosed) {\r\n            return;\r\n        }\r\n        this.controlClosed = true;\r\n\r\n        var resourcesReleased = false;\r\n\r\n        var self = this;\r\n        function releaseResources(): void {\r\n            if (resourcesReleased || !self.iframe) {\r\n                return;\r\n            }\r\n            resourcesReleased = true;\r\n            self.iframe.style.display = 'none';\r\n            self.iframe = null;\r\n        }\r\n        this.communicationManager.addEventListener('ControlShutdown', releaseResources);\r\n        this.communicationManager.initiateShutdown();\r\n        window.setTimeout(function() {\r\n            releaseResources();\r\n        }, 2000);\r\n\r\n        this.dispatchEvent('ControlClosed', new Event());\r\n    }\r\n\r\n    public postMessageToPlugin(message: string): void {\r\n        if (this.iframe) {\r\n            if (this.useNativeWebView) {\r\n                (<Electron.WebviewTag>this.iframe).send('daytona', message);\r\n            } else {\r\n                var contentWindow = (<HTMLIFrameElement>this.iframe).contentWindow;\r\n                if (contentWindow) {\r\n                    contentWindow.postMessage(message, '*');\r\n                }\r\n            }\r\n        }\r\n    }\r\n    public publishLibraryObjects(jsonManifest: IJSONManifest): void {\r\n        this.publishObject(outputMarhalerName, new OutputMarshaler(this.providers.logProvider));\r\n\r\n        // publish storage\r\n        if (this.providers.storageProvider) {\r\n            let storageMarshaler: StorageMarshaler = new StorageMarshaler(this, this.providers.storageProvider);\r\n            this.publishObject(storageMarshalerName, storageMarshaler);\r\n        }\r\n\r\n        if (this.providers.themeProvider) {\r\n            var pluginCss: string;\r\n            var themeMap: ThemeMap;\r\n            var themePromises: Promise<any>[] = [];\r\n            themePromises.push(this.providers.themeProvider.getPluginCss().then((css) => {\r\n                pluginCss = css;\r\n            }));\r\n            themePromises.push(this.providers.themeProvider.getThemeMap().then((map) => {\r\n                themeMap = map;\r\n\r\n                // add themed images\r\n                var hostConfig = jsonManifest.webhost;\r\n                if (hostConfig) {\r\n                    var themed_images = hostConfig['themed_images'];\r\n                    for (var key in themed_images) {\r\n                        var imageConfig = themed_images[key];\r\n                        if (!imageConfig) {\r\n                            return;\r\n                        }\r\n\r\n                        var path = imageConfig[\"bitmap_source\"];\r\n\r\n                        // If the path starts with \"data:\" it means it represents the\r\n                        // serialized content of the image, otherwise is an actual path\r\n                        // and we need to concatenate it with the base directory.\r\n                        if (path && !(path.toLowerCase().indexOf(\"data:\") === 0)) {\r\n                            path = this.baseDirectory + path;\r\n                        }\r\n\r\n                        themeMap[key] = path;\r\n                    }\r\n                }\r\n            }));\r\n            Q.all(themePromises).then(() => {\r\n                var themeMarshaler = new ThemeMarshaler(this, this.providers.fileProvider, themeMap, pluginCss);\r\n                this.publishObject(themeMarshalerName, themeMarshaler);\r\n                this.providers.themeProvider.addEventListener('themechanged', () => {\r\n                    this.providers.themeProvider.getThemeMap().then((map) => {\r\n                        themeMarshaler.fireThemeChangedEvent(map);\r\n                    });\r\n                });\r\n            }, (error) => {\r\n                this.reportError('Cannot load theme resources: ' + error);\r\n            });\r\n        }\r\n\r\n        if (this.providers.resourcesProvider) {\r\n            var aliases = jsonManifest['resource_aliases'];\r\n            this.loadResourcesAndAlias(this.baseDirectory, aliases).then((result: { resourceMap: ResourceMap; defaultAlias: string; }) => {\r\n                if (result) {\r\n                    var resourceMarshaler = new ResourcesMarshaler(this, result.resourceMap, result.defaultAlias, this.providers.resourcesProvider.getDefaultErrorMessage());\r\n                    this.publishObject(resourcesMarshalerName, resourceMarshaler);\r\n                    this.providers.resourcesProvider.addEventListener('culturechanged', () => {\r\n                        this.loadResourcesAndAlias(this.baseDirectory, aliases).then((result: { resourceMap: ResourceMap; defaultAlias: string; }) => {\r\n                            if (result) {\r\n                                resourceMarshaler.fireResourcesChangedEvent(result.resourceMap);\r\n                            }\r\n                        }, (error) => {\r\n                            this.reportError('Cannot load resources: ' + error);\r\n                        });\r\n                    });\r\n                }\r\n            }, (error) => {\r\n                this.reportError('Cannot load resources: ' + error);\r\n            });\r\n        }\r\n\r\n        if (this.providers.commandsProvider) {\r\n            var names = this.providers.commandsProvider.getAliases();\r\n            var commandsMarshaller = new CommandsMarshaler(this, names.menuNames, names.commandNames, this.providers.commandsProvider);\r\n            this.publishObject(commandsMarshalerName, commandsMarshaller);\r\n            this.providers.commandsProvider.addEventListener('commandexec', (source: IEventTarget, event: Event) => {\r\n                commandsMarshaller.fireCommandExecuted((<ExecuteCommandEventArgs>event).commandName);\r\n            });\r\n        }\r\n\r\n        if (this.providers.settingsProvider) {\r\n            var settingsMarshaller = new SettingsMarshaler(this, this.providers.settingsProvider);\r\n            this.publishObject(settingsMarshalerName, settingsMarshaller);\r\n        }\r\n\r\n        if (this.providers.contextMenuProvider) {\r\n            var contextMenuMarshaller = new ContextMenuMarshaler(this, this.providers.contextMenuProvider);\r\n            this.publishObject(contextMenuMarshalerName, contextMenuMarshaller);\r\n            ['contextmenuclicked', 'contextmenudismissed', 'contextmenufocused', 'contextmenuinitialized', 'contextmenuopened'].forEach((eventType) => {\r\n                this.providers.contextMenuProvider.addEventListener(eventType, (source: IEventTarget, event: Event) => {\r\n                    contextMenuMarshaller.fireEvent(eventType, event);\r\n                });\r\n            });\r\n        }\r\n\r\n        if (this.providers.hostProvider) {\r\n            var hostMarshaler = new HostMarshaler(this.providers.hostProvider);\r\n            this.publishObject(hostMarshalerName, hostMarshaler);\r\n        }\r\n\r\n        if (this.providers.tooltipProvider) {\r\n            var tooltipMarshaler = new TooltipMarshaler(this.providers.tooltipProvider);\r\n            this.publishObject(tooltipMarshalerName, tooltipMarshaler);\r\n        }\r\n    }\r\n\r\n    private loadResourcesAndAlias(baseDirectory: string, aliases: ResourceAliases): Promise<{ resourceMap: ResourceMap; defaultAlias: string; }> {\r\n        var aliasPromises: Promise<void>[] = [];\r\n        var resourceMap: ResourceMap = {};\r\n        var defaultAlias: string;\r\n        if (aliases) {\r\n            for (var alias in aliases) {\r\n                (function(aliasKey, resourcesProvider) {\r\n                    aliasPromises.push(resourcesProvider.loadResources(baseDirectory, aliases[aliasKey].path).then(function(loadedResources) {\r\n                        resourceMap[aliasKey] = loadedResources;\r\n                    }));\r\n                    if (aliases[aliasKey]['is_default']) {\r\n                        defaultAlias = aliasKey;\r\n                    }\r\n                })(alias, this.providers.resourcesProvider);\r\n            }\r\n            return Q.all(aliasPromises).then(() => {\r\n                return {\r\n                    resourceMap: resourceMap,\r\n                    defaultAlias: defaultAlias\r\n                };\r\n            });\r\n        }\r\n\r\n        return Q.resolve<{ resourceMap: ResourceMap; defaultAlias: string; }>(null);\r\n    }\r\n\r\n    private processMessage(message: string): void {\r\n        if (message[0] === '_' && message[1] === '_') {\r\n            var controlMessage = JSON.parse(message.substr(2));\r\n            switch (controlMessage.method) {\r\n                case 'reportError': {\r\n                    if (this.providers.logProvider) {\r\n                        var message = '';\r\n                        if (controlMessage.args && controlMessage.args.length >= 2) {\r\n                            message += controlMessage.args[0] + '\\n at: ' + controlMessage.args[1] + ' (' + controlMessage.args[2] + ')' + (controlMessage.args[3] ? ('\\n additional information: ' + controlMessage.args[3]) : '');\r\n                        }\r\n                        this.reportError('ScriptedControl Error: ' + message);\r\n                    }\r\n                    break;\r\n\r\n                }\r\n                case 'terminate': {\r\n                    //this.close();\r\n                    break;\r\n\r\n                }\r\n                case 'fireCodeMarker': {\r\n                    break;\r\n\r\n                }\r\n                default: {\r\n                    break;\r\n\r\n                }\r\n            }\r\n        } else {\r\n            this.communicationManager.processMessage(message);\r\n        }\r\n    }\r\n    public processFocusEvent(): void {\r\n        this.dispatchEvent('GotFocus', new Event());\r\n    }\r\n    public processBlurEvent(): void {\r\n        this.dispatchEvent('LostFocus', new Event());\r\n    }\r\n    public createSynchronousJsonPortMarshaler(objDefinition: any): SynchronousJsonPortMarshaler {\r\n        var marshaler = new SynchronousJsonPortMarshaler(this);\r\n        if (objDefinition && typeof objDefinition === 'object') {\r\n            Object.getOwnPropertyNames(objDefinition).forEach((name) => {\r\n                var pd = Object.getOwnPropertyDescriptor(objDefinition, name);\r\n                Object.defineProperty(marshaler, name, pd);\r\n            });\r\n        }\r\n        return marshaler;\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}